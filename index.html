<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap" rel="stylesheet">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/vendor/jQuery PowerTip/jquery.powertip.min.css">

        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/pixel-image.css">
        <link rel="stylesheet" href="assets/css/sprites.css">

        <title>Rogue-Like RPG</title>
        <link rel="shortcut icon" href="assets/ico/Ico.ico">
    </head>
    <body>
        
        <aside class="border-shadow" active="false">
            <div class="file-input">
                <span>
                    <input type="file" name="file-input" id="file-input" class="upload-box"/>
                    <label class="file-upload" for="file-input">
                        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        viewBox="0 0 211.293 211.293" style="enable-background:new 0 0 211.293 211.293;" xml:space="preserve">
                            <g>
                                <path d="M176.777,54.027H133.43c-4.142,0-7.5,3.357-7.5,7.5c0,4.142,3.358,7.5,7.5,7.5h35.847v127.266H42.016V69.027H77.86 c4.142,0,7.5-3.357,7.5-7.5c0-4.143-3.358-7.5-7.5-7.5H34.516c-4.142,0-7.5,3.357-7.5,7.5v142.266c0,4.143,3.358,7.5,7.5,7.5 h142.261c4.142,0,7.5-3.357,7.5-7.5V61.527C184.277,57.385,180.919,54.027,176.777,54.027z"/>
                                <path d="M82.058,41.693l16.087-16.087V135.66c0,4.143,3.358,7.5,7.5,7.5c4.143,0,7.5-3.357,7.5-7.5V25.607l16.086,16.086 c1.464,1.465,3.384,2.197,5.303,2.197c1.919,0,3.838-0.733,5.303-2.196c2.929-2.93,2.929-7.678,0-10.607l-28.889-28.89 C109.542,0.79,107.634,0,105.645,0c-1.988,0-3.896,0.79-5.303,2.196l-28.891,28.89c-2.929,2.929-2.929,7.678,0,10.606 C74.38,44.622,79.129,44.621,82.058,41.693z"/>
                            </g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g>
                        </svg>
                        <span>
                            Upload
                        </span>
                    </label>
                </span>
            </div>
            <div class="file-download" onclick="saveGame()">
                <span>
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    viewBox="0 0 211.293 211.293" style="enable-background:new 0 0 211.293 211.293;" xml:space="preserve">
                        <g>
                            <path d="M176.777,54.027H133.43c-4.143,0-7.5,3.357-7.5,7.5c0,4.142,3.357,7.5,7.5,7.5h35.848v127.266H42.016V69.027h35.844 c4.143,0,7.5-3.357,7.5-7.5c0-4.143-3.357-7.5-7.5-7.5H34.516c-4.142,0-7.5,3.357-7.5,7.5v142.266c0,4.143,3.358,7.5,7.5,7.5 h142.262c4.143,0,7.5-3.357,7.5-7.5V61.527C184.277,57.385,180.92,54.027,176.777,54.027z"/>
                            <path d="M82.058,101.468c-2.929-2.929-7.678-2.93-10.606-0.001c-2.93,2.93-2.93,7.678-0.001,10.607l28.889,28.89 c1.407,1.407,3.314,2.197,5.304,2.197c1.989,0,3.896-0.79,5.303-2.196l28.891-28.89c2.93-2.929,2.93-7.678,0.001-10.606 c-2.929-2.929-7.678-2.93-10.606-0.001l-16.088,16.087V7.5c0-4.143-3.357-7.5-7.5-7.5s-7.5,3.357-7.5,7.5v110.054L82.058,101.468z" />
                        </g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g>
                    </svg>
                    <span>Download</span>
                </span>
            </div>
            <div id="aside-toggle">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                    viewBox="0 0 300.003 300.003" style="enable-background:new 0 0 300.003 300.003;" xml:space="preserve">
                <g>
                    <g>
                        <path d="M150,0C67.159,0,0.001,67.159,0.001,150c0,82.838,67.157,150.003,149.997,150.003S300.002,232.838,300.002,150
                            C300.002,67.159,232.842,0,150,0z M217.685,189.794c-5.47,5.467-14.338,5.47-19.81,0l-48.26-48.27l-48.522,48.516
                            c-5.467,5.467-14.338,5.47-19.81,0c-2.731-2.739-4.098-6.321-4.098-9.905s1.367-7.166,4.103-9.897l56.292-56.297
                            c0.539-0.838,1.157-1.637,1.888-2.368c2.796-2.796,6.476-4.142,10.146-4.077c3.662-0.062,7.348,1.281,10.141,4.08
                            c0.734,0.729,1.349,1.528,1.886,2.365l56.043,56.043C223.152,175.454,223.156,184.322,217.685,189.794z"/>
                    </g>
                </g>
                <g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g>
                </svg>
            </div>
        </aside>

        <main>
            <div class="row">
                <div class="col">
                    <div class="container">
                        <div class="item-modal border-shadow row align-content-center justify-content-center">

                            <div id="pixel-border">
                                <div id="pixel-container">
                                    <div class="pixel North-West"></div>
                                    <div class="pixel North Up-West"></div>
                                    <button disabled id="button-up" class="pixel North up" onclick="go(room, 'up', false)">up</button>
                                    <div class="pixel North Up-East"></div>
                                    <div class="pixel North-East"></div>
                    
                                    <div class="pixel West Left-North"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel middle" id="title"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel East Right-North"></div>
                    
                                    <button disabled id="button-left" class="pixel West left" onclick="go(room, 'left', false)">left</button>
                                    <div class="pixel middle" id="item"></div>
                                    <button class="pixel middle" onclick="canGo(room); checkRoom(room); $('#infoLog').html('<span>The player begins their adventure.</span>'); $('#title').html(window.room); $(this).replaceWith(`<div class='pixel middle' id='enemy'></div>`);" id="start">
                                        <div>Start</div>
                                        <div>Game</div>
                                    </button>
                                    <div class="pixel middle"></div>
                                    <button disabled id="button-right" class="pixel East right" onclick="go(room, 'right', false)">right</button>
                    
                                    <div class="pixel West Left-South"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel East Right-South"></div>
                    
                                    <div class="pixel South-West"></div>
                                    <div class="pixel South Down-West"></div>
                                    <button disabled id="button-down" class="pixel South down" onclick="go(room, 'down', false)">down</button>
                                    <div class="pixel South Down-East"></div>
                                    <div class="pixel South-East"></div>
                                </div>
                            </div>
    
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="container">
    
                        <div class="item-modal border-shadow">
                            <div class="item-wrapper">
                                <div class="info-box border-shadow">
                                    <span class="info-title">Health</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerHealth">
                                            <img id="heart-0" src="assets/images/Hearts/4 Heart.png" alt="" />
                                            <img id="heart-1" src="assets/images/Hearts/4 Heart.png" alt="" />
                                            <img id="heart-2" src="assets/images/Hearts/4 Heart.png" alt="" />
                                            <img id="heart-3" src="assets/images/Hearts/4 Heart.png" alt="" />
                                            <img id="heart-4" src="assets/images/Hearts/4 Heart.png" alt="" />
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Weapon</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerWeapon">
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Armour</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerArmour">
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Status</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerStatus"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Inventory</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerInventory"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow" style="overflow: auto;">
                                    <button class="info-title" onclick="$('.adventure-container').show()">Log</button>
                                    <div class="info-content" style="max-height: 300px;">
                                        <span class="info-value" id="infoLog"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow row" style="margin-top: auto;">
                                    <div class="info-content" style="width: 100%;">
                                        <div class="button-section">
                                            <button class="action-button" id="get-button">Get Item</button>
                                            <button class="action-button">-</button>
                                        </div>
                                        <button class="action-button" id="attack-button">Attack</button>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                    </div>
                </div>
            </div>
        </main>

        <div class="update-container">
            <div class="update-log">
                <button class="close-log-button" onclick="$('.update-container').remove();">Close</button>
            </div>
        </div>

        <script src="assets/vendor/jquery/jquery.min.js"></script>
        <script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/vendor/jQuery PowerTip/jquery.powertip.min.js"></script>

        <script>
            var player = null;
            var foes = null;
            var armour = null;
            var potions = null;
            var weapons = null;
            var rooms = null;
            var update_log = null;

            function getData(url, cb, spawn) {
                fetch(url)
                .then(response => response.json())
                .then(result => cb(result));
            }

            

            // getData(url, (data) => console.log({ data }));

            getData("json/player.json", (data) => player = data );
            getData("json/foes.json", (data) => foes = data );
            getData("json/armour.json", (data) => armour = data );
            getData("json/poisons.json", (data) => poisons = data );
            getData("json/potions.json", (data) => potions = data );
            getData("json/weapons.json", (data) => weapons = data );
            getData("assets/Levels/L1.json", (data) => rooms = data );
            
            getData("update-logs.json", (data) => update_log = data );

            var fade = 2;
            var room = "5-5";

            function loadmap(level) {
                getData("assets/Levels/" + level + ".json", (data) => window.rooms = data )

                room = "5-5";
                $('.title').html(window.room);
                canGo(window.room);
                checkRoom(window.room);
            };

            function spawnMonsters(){
                if (rooms != null) {
                    x = 0;
                    while (x != 4) {
                        selector = Math.floor(Math.random() * (Object.keys(window.rooms).length - 1));
                        
                        if (window.rooms[Object.keys(window.rooms)[selector]]['enemy'].length == 0 && Object.keys(window.rooms)[selector] != '5-5' && Object.keys(window.rooms)[selector] != '5-4') {
                            x += 1;
                            window.rooms[Object.keys(window.rooms)[selector]]['enemy'].push(Object.keys(foes)[Math.floor(Math.random() * 9)]);
                        };
                    };
                } else {
                    setTimeout(spawnMonsters, 250);
                };
            };

            spawnMonsters();

            var bypassCheck = document.location.search;

            if (bypassCheck.includes('NoUpdateLog')) {
                $('.update-container').remove();
            };

            function loadUpdateLog() {
                if ( update_log != null ) {
                    const currentLog = update_log[ Object.keys( update_log )[ Object.keys( update_log ).length - 1 ] ];
                    const updateContainer = $(`<pre class="m-0"></pre>`)
                    $(updateContainer).append(`<span class="markdown-green">` + Object.keys( update_log )[ Object.keys( update_log ).length - 1 ] + `</span> \n`)
                    Object.keys(currentLog).forEach(key => {
                        if (key != 'Comment') {
                            $(updateContainer).append(`<span class="markdown-blue"># ` + key + `</span> \n`)
                            currentLog[key].forEach(value => {
                                $(updateContainer).append(`<span class="markdown-red">-</span> <span>` + value + `</span>\n`)
                            });
                            $(updateContainer).append(`\n`)
                        } else {
                            $(updateContainer).append(`<span class="markdown-green">` + currentLog[key] + `</span>`)
                        }
                    });
                    $('.update-log').append(updateContainer)
                } else {
                    setTimeout( loadUpdateLog, 250 )
                };
            };
            loadUpdateLog();

        </script>

        <script src="assets/js/main.js"></script>
        <script src="assets/js/traits.js"></script>
        <script src="assets/js/gameState.js"></script>

        

        <a id="saveDownload" style="display: none;"></a>
        <div class="adventure-container" style="display: none;">
            <div class="adventure-log" id="log-store" style="flex-direction: column;">
                <p class="log-text">Your adventure is only just starting!</p>
                <button class="close-log-button" onclick="$('.adventure-container').hide();">Close</button>
            </div>
        </div>
    </body>
</html>