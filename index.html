<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap" rel="stylesheet">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/vendor/jQuery PowerTip/jquery.powertip.min.css">

        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/pixel-image.css">

        <title>Rogue-Like RPG</title>
        <link rel="shortcut icon" href="assets/ico/Ico.ico">
    </head>
    <body>
        <main>
            <div class="row">
                <div class="col">
                    <div class="container">
                        <div class="item-modal border-shadow row align-content-center justify-content-center">

                            <div id="pixel-border">
                                <div id="pixel-container">
                                    <div class="pixel North-West"></div>
                                    <div class="pixel North Up-West"></div>
                                    <button disabled id="button-up" class="pixel North up" onclick="go(room, 'up')">up</button>
                                    <div class="pixel North Up-East"></div>
                                    <div class="pixel North-East"></div>
                    
                                    <div class="pixel West Left-North"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel middle" id="title"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel East Right-North"></div>
                    
                                    <button disabled id="button-left" class="pixel West left" onclick="go(room, 'left')">left</button>
                                    <div class="pixel middle"></div>
                                    <button class="pixel middle" onclick="canGo(room); checkRoom(room); $('#infoLog').html('<span>The player begins their adventure.</span>'); $('#title').html(window.room); $(this).replaceWith(`<div class='pixel middle' id='enemy'></div>`);" id="start">
                                        <div>Start</div>
                                        <div>Game</div>
                                    </button>
                                    <div class="pixel middle"></div>
                                    <button disabled id="button-right" class="pixel East right" onclick="go(room, 'right')">right</button>
                    
                                    <div class="pixel West Left-South"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel middle"></div>
                                    <div class="pixel East Right-South"></div>
                    
                                    <div class="pixel South-West"></div>
                                    <div class="pixel South Down-West"></div>
                                    <button disabled id="button-down" class="pixel South down" onclick="go(room, 'down')">down</button>
                                    <div class="pixel South Down-East"></div>
                                    <div class="pixel South-East"></div>
                                </div>
                            </div>
    
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="container">
    
                        <div class="item-modal border-shadow">
                            <div class="item-wrapper">
                                <div class="info-box border-shadow">
                                    <span class="info-title">Health</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerHealth">20</span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Weapon</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerWeapon">
                                            <button class="equipped-item tip" itemcatagory="Weapon" itemtype="Unarmed" extraTraits='[]'>Unarmed</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Armour</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerArmour">
                                            <button class="equipped-item tip" itemcatagory="Armour" itemtype="Unarmoured" extraTraits='[]'>Unarmoured</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Status</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerStatus"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Inventory</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerInventory">
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Leather" extratraits="[]">Leather</button>
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Plate" extratraits="[]">Plate</button>
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Spiked" extratraits="[]">Spiked</button>
                                            <button class="inventory-item tip" itemcatagory="Poison" itemtype="Poison" extratraits="[]">Poison</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Greater Healing" extratraits="[]">Potion of Greater Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Healing" extratraits="[]">Potion of Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Lesser Healing" extratraits="[]">Potion of Lesser Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Power" extratraits="[]">Potion of Power</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Club" extratraits="[]">Club</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Dagger" extratraits="[]">Dagger</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Greatsword" extratraits="[]">Greatsword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Longsword" extratraits="[]">Longsword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Mace" extratraits="[]">Mace</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Short Spear" extratraits="[]">Short Spear</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Short Sword" extratraits="[]">Short Sword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Spear" extratraits="[]">Spear</button>
                                            <button class="inventory-item tip" itemcatagory="Poison" itemtype="Strong Poison" extratraits="[]">Strong Poison</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow" style="overflow: auto;">
                                    <button class="info-title" onclick="$('.adventure-container').show()">Log</button>
                                    <div class="info-content" style="max-height: 300px;">
                                        <span class="info-value" id="infoLog"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow row justify-content-center" style="margin-top: auto;">
                                    <div class="info-content">
                                        <button class="attack-button">Attack</button>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                    </div>
                </div>
            </div>
        </main>

        <div class="update-container">
            <div class="update-log">
                <button class="close-log-button" onclick="$('.update-container').remove();">Close</button>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="assets/vendor/jQuery PowerTip/jquery.powertip.min.js"></script>

        <script>
            var player = null;
            var foes = null;
            var armour = null;
            var potions = null;
            var weapons = null;
            var rooms = null;
            var update_log = null;

            function getData(url, cb, spawn) {
                fetch(url)
                .then(response => response.json())
                .then(result => cb(result));
            }

            

            // getData(url, (data) => console.log({ data }));

            getData("json/player.json", (data) => player = data );
            getData("json/foes.json", (data) => foes = data );
            getData("json/armour.json", (data) => armour = data );
            getData("json/poisons.json", (data) => poisons = data );
            getData("json/potions.json", (data) => potions = data );
            getData("json/weapons.json", (data) => weapons = data );
            getData("assets/Levels/L1.json", (data) => rooms = data );
            
            getData("update-logs.json", (data) => update_log = data );

            var fade = 2;
            var room = "5-5";

            function loadmap(level) {
                getData("assets/Levels/" + level + ".json", (data) => window.rooms = data )

                room = "5-5";
                $('.title').html(window.room);
                canGo(window.room);
                checkRoom(window.room);
            };

            function spawnMonsters(){
                if (rooms != null) {
                    x = 0;
                    while (x != 4) {
                        selector = Math.floor(Math.random() * (Object.keys(window.rooms).length - 1));
                        
                        if (window.rooms[Object.keys(window.rooms)[selector]]['enemy'].length == 0 && Object.keys(window.rooms)[selector] != '5-5' && Object.keys(window.rooms)[selector] != '5-4') {
                            x += 1;
                            window.rooms[Object.keys(window.rooms)[selector]]['enemy'].push(Object.keys(foes)[Math.floor(Math.random() * 9)]);
                        };
                    };
                } else {
                    setTimeout(spawnMonsters, 250);
                };
            };

            spawnMonsters();

            var bypassCheck = document.location.search;

            if (bypassCheck.includes('NoUpdateLog')) {
                $('.update-container').remove();
            };

            function loadUpdateLog() {
                if ( update_log != null ) {
                    const currentLog = update_log[ Object.keys( update_log )[ Object.keys( update_log ).length - 1 ] ];
                    const updateContainer = $(`<pre class="m-0"></pre>`)
                    $(updateContainer).append(`<span class="markdown-green">` + Object.keys( update_log )[ Object.keys( update_log ).length - 1 ] + `</span> \n`)
                    Object.keys(currentLog).forEach(key => {
                        if (key != 'Comment') {
                            $(updateContainer).append(`<span class="markdown-blue"># ` + key + `</span> \n`)
                            currentLog[key].forEach(value => {
                                $(updateContainer).append(`<span class="markdown-red">-</span> <span>` + value + `</span>\n`)
                            });
                            $(updateContainer).append(`\n`)
                        } else {
                            $(updateContainer).append(`<span class="markdown-green">` + currentLog[key] + `</span>`)
                        }
                    });
                    $('.update-log').append(updateContainer)
                } else {
                    setTimeout( loadUpdateLog, 250 )
                };
            };
            loadUpdateLog();

        </script>

        <script src="assets/js/main.js"></script>
        <script src="assets/js/traits.js"></script>

        <div class="adventure-container" style="display: none;">
            <div class="adventure-log" id="log-store" style="flex-direction: column;">
                <p class="log-text">Your adventure is only just starting!</p>
                <button class="close-log-button" onclick="$('.adventure-container').hide();">Close</button>
            </div>
        </div>
    </body>
</html>