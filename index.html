<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="https://narikraus.github.io/Rogue-like-RPG/" target="_blank">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/vendor/jQuery PowerTip/jquery.powertip.min.css">

        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/pixel-image.css">

        <title>Rogue-Like RPG</title>
        <link rel="shortcut icon" href="assets/ico/Ico.ico">
    </head>
    <body>
        <main>
            <div class="row">
                <div class="col">
                    <div class="container">
                        <div class="item-modal border-shadow align-content-center justify-content-center row">
                                
                            <div class="pixel North-West"></div>
                            <div class="pixel North Up-West"></div>
                            <button disabled id="button-up" class="pixel North up h4" onclick="go(room, 'up')">up</button>
                            <div class="pixel North Up-East"></div>
                            <div class="pixel North-East"></div>
                            
                            <div class="w-100"></div>
            
                            <div class="pixel West Left-North"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel middle h4" id="title"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel East Right-North"></div>
                            
                            <div class="w-100"></div>
            
                            <button disabled id="button-left" class="pixel West left h4" onclick="go(room, 'left')">left</button>
                            <div class="pixel middle"></div>
                            <button class="pixel middle" onclick="
                                canGo(room);
                                checkRoom(room);
                                $('#title').html(window.room);
                                $(this).replaceWith(`<div class='pixel middle h4' id='enemy'></div>`);
                            " id="start">
                                <div class="h4">Start</div>
                                <div class="h4">Game</div>
                            </button>
                            <div class="pixel middle"></div>
                            <button disabled id="button-right" class="pixel East right h4" onclick="go(room, 'right')">right</button>
                            
                            <div class="w-100"></div>
            
                            <div class="pixel West Left-South"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel East Right-South"></div>
                            
                            <div class="w-100"></div>
            
                            <div class="pixel South-West"></div>
                            <div class="pixel South Down-West"></div>
                            <button disabled id="button-down" class="pixel South down h4" onclick="go(room, 'down')">down</button>
                            <div class="pixel South Down-East"></div>
                            <div class="pixel South-East"></div>
    
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="container">
    
                        <div class="item-modal border-shadow">
                            <div class="item-wrapper">
                                <div class="info-box border-shadow">
                                    <span class="info-title">Health</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerHealth">20</span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Weapon</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerWeapon">
                                            <button class="equipped-item tip" itemcatagory="Weapon" itemtype="Unarmed" extraTraits='[]'>Unarmed</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Armour</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerArmour">
                                            <button class="equipped-item tip" itemcatagory="Armour" itemtype="Unarmoured" extraTraits='[]'>Unarmoured</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Status</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerStatus"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Inventory</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerInventory">
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Leather" extraTraits='[]'>Leather</button>
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Plate" extraTraits='[]'>Plate</button>
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Spiked" extraTraits='[]'>Spiked</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Club" extraTraits='[]'>Club</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Dagger" extraTraits='[]'>Dagger</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Greatsword" extraTraits='[]'>Greatsword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Spear" extraTraits='[]'>Spear</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Longsword" extraTraits='[]'>Longsword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Mace" extraTraits='[]'>Mace</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Short Spear" extraTraits='[]'>Short Spear</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Short Sword" extraTraits='[]'>Short Sword</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Lesser Healing" extraTraits='[]'>Potion of Lesser Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Healing" extraTraits='[]'>Potion of Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Greater Healing" extraTraits='[]'>Potion of Greater Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Power" extraTraits='[]'>Potion of Power</button>
                                            <button class="inventory-item tip" itemcatagory="Poison" itemtype="Poison" extraTraits='[]'>Poison</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow" style="overflow: auto;">
                                    <button class="info-title" onclick="$('.adventure-container').show()">Log</button>
                                    <div class="info-content" style="max-height: 300px;">
                                        <span class="info-value" id="infoLog">
                                            <span>The player begins their adventure.</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow row justify-content-center" style="margin-top: auto;">
                                    <div class="info-content">
                                        <button class="attack-button">Attack</button>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                    </div>
                </div>
            </div>
        </main>

        <div class="update-container">
            <div class="update-log">
                <button class="close-log-button" onclick="$('.update-container').remove();">Close</button>
                <pre>
<code>
<span class="markdown-green">30/06/2022</span>

<span class="markdown-blue"># Update Log</span>
<span class="markdown-red">-</span> Implemented textures to the visible map.
<span class="markdown-red">-</span> Created functions that allow for Enchantments. Yet to be implemented into gameplay.
<span class="markdown-red">-</span> Created multiple Potions that restore health or increase damage.
<span class="markdown-red">-</span> Added the trait 'Piercing' that halves the defending party's effective defence.
<span class="markdown-red">-</span> Created a Log system to display what the player does and store each log for visualisation. (Click the Log Index to view)

<span class="markdown-blue"># Bug Fixes</span>
<span class="markdown-red">-</span> The 'Vampiric' trait now works as intended. 

<span class="markdown-blue"># Next Tasks</span>
<span class="markdown-red">-</span> Allowing the player to get to the 2nd and 3rd levels.
<span class="markdown-red">-</span> Creating status effects such as Poisoned, Enraged and Paralysed.
<span class="markdown-red">-</span> Give functionality to poisons.
<span class="markdown-red">-</span> Capping the inventory to a maximum capacity yet to be decided.
<span class="markdown-red">-</span> Prevent running from monsters.

<span class="markdown-blue"># Bugs</span>
<span class="markdown-red">-</span> Player death is not permanent.

<span class="markdown-italics">Please note that visuals do not work properly on mobile devices.</span>
</code>
                </pre>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="assets/vendor/jQuery PowerTip/jquery.powertip.min.js"></script>

        <script>
            $(document).ready(function() {
                var player = null;
                var foes = null;
                var armour = null;
                var potions = null;
                var weapons = null;
                var rooms = null;

                function getData(url, cb, spawn) {
                    fetch(url)
                    .then(response => response.json())
                    .then(result => cb(result));
                }

                

                // getData(url, (data) => console.log({ data }));

                getData("json/player.json", (data) => player = data ).done(function() {
                    getData("json/foes.json", (data) => foes = data ).done(function() {
                        getData("json/armour.json", (data) => armour = data ).done(function() {
                            getData("json/poisons.json", (data) => poisons = data ).done(function() {
                                getData("json/potions.json", (data) => potions = data ).done(function() {
                                    getData("json/weapons.json", (data) => weapons = data ).done(function() {
                                        getData("assets/Levels/L1.json", (data) => rooms = data ).done(function() {
                                            reload();
                                        });
                                    });
                                });
                            });
                        });
                    });
                });

                var fade = 2;
                var room = "5-5";

                function loadmap(level) {
                    getData("assets/Levels/" + level + ".json", (data) => window.rooms = data )

                    room = "5-5";
                    $('.title').html(window.room);
                    canGo(window.room);
                    checkRoom(window.room);
                };

                function spawnMonsters(){
                    if (rooms != null) {
                        x = 0;
                        while (x != 4) {
                            selector = Math.floor(Math.random() * (Object.keys(window.rooms).length - 1));
                            
                            if (window.rooms[Object.keys(window.rooms)[selector]]['enemy'].length == 0 && Object.keys(window.rooms)[selector] != '5-5' && Object.keys(window.rooms)[selector] != '5-4') {
                                x += 1;
                                window.rooms[Object.keys(window.rooms)[selector]]['enemy'].push(Object.keys(foes)[Math.floor(Math.random() * 9)]);
                            };
                        };
                    } else {
                        setTimeout(spawnMonsters, 250);
                    };
                };

                spawnMonsters();

                var bypassCheck = document.location.search;

                if (bypassCheck.includes('NoUpdateLog')) {
                    $('.update-container').remove();
                };
            });
        </script>

        <script src="assets/js/main.js"></script>
        <script src="assets/js/traits.js"></script>

        <div class="adventure-container" style="display: none;">
            <div class="adventure-log" id="log-store" style="flex-direction: column;">
                <button class="close-log-button" onclick="$('.adventure-container').hide();">Close</button>
            </div>
        </div>

    </body>
</html>