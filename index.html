<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="https://narikraus.github.io/Rogue-like-RPG/" target="_blank">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="/assets/css/style.css" rel="stylesheet">

        <title>Hello, world!</title>
    </head>
    <body class="tag2">
        <nav class="position-absolute navbar navbar-light">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Fade
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li><button class="dropdown-item active" onclick="$(this).parent().parent().find('.active').removeClass('active');$(this).addClass('active');fade=2;$('body').removeClass('tag1').addClass('tag2');">Default</button></li>
                                <li><button class="dropdown-item" onclick="$(this).parent().parent().find('.active').removeClass('active');$(this).addClass('active');fade=1;$('body').addClass('tag1').removeClass('tag2');">Fast</button></li>
                                <li><button class="dropdown-item" onclick="$(this).parent().parent().find('.active').removeClass('active');$(this).addClass('active');fade=0;$('body').removeClass('tag1').removeClass('tag2');">Off</button></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="row">
            <div class="col">
                <div class="container">
                    <div class="align-content-center justify-content-center row" style="height: 100vh;">
        
                        <div class="pixel"></div>
                        <div class="pixel"></div>
                        <button disabled id="button-up" class="pixel up h4" onclick="go(room, 'up')">up</button>
                        <div class="pixel"></div>
                        <div class="pixel"></div>
                        
                        <div class="w-100"></div>
        
                        <div class="pixel"></div>
                        <button disabled class="pixel middle" id="shop">
                            <div class="h5" id="shop-item"></div>
                            <div class="h5" id="shop-price"></div>
                        </button>
                        <div class="pixel middle"><h2 class="title"></h2></div>
                        <button disabled class="h5 pixel middle" id="item">
                        </button>
                        <div class="pixel"></div>
                        
                        <div class="w-100"></div>
        
                        <button disabled id="button-left" class="pixel left h4" onclick="go(room, 'left')">left</button>
                        <div class="pixel middle"></div>
                        <button class="pixel middle" onclick="
                            $(this).attr('id', 'enemy').attr('onclick', '').unbind('click').addClass('h4');
                            switch (window.fade) {
                                case 0:
                                    $(this).html('');
                                    canGo(room);
                                    checkRoom(room);
                                    $('.title').html(window.room);
                                    break;
                                case 1:
                                    blink();
                                    setTimeout(() => {
                                        $(this).html('');
                                        canGo(room);
                                        checkRoom(room);
                                        $('.title').html(window.room);
                                    }, 250);
                                    break;
                                case 2:
                                blink();
                                    setTimeout(() => {
                                        $(this).html('');
                                        canGo(room);
                                        checkRoom(room);
                                        $('.title').html(window.room);
                                    }, 500);
                                    break;
                            };
                        " id="start">
                            <div class="h2">Start</div>
                            <div class="h2">Game</div>
                        </button>
                        <div class="pixel middle"></div>
                        <button disabled id="button-right" class="pixel right h4" onclick="go(room, 'right')">right</button>
                        
                        <div class="w-100"></div>
        
                        <div class="pixel"></div>
                        <button disabled id="attack-l" class="pixel middle h5"></button>
                        <button disabled id="attack-m" class="pixel middle h5"></button>
                        <button disabled id="attack-h" class="pixel middle h5"></button>
                        <div class="pixel"></div>
                        
                        <div class="w-100"></div>
        
                        <div class="pixel"></div>
                        <div class="pixel"></div>
                        <button disabled id="button-down" class="pixel down h4" onclick="go(room, 'down')">down</button>
                        <div class="pixel"></div>
                        <div class="pixel"></div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="container">

                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            var rooms = (function () {
                var json = null;
                $.ajax({
                    'async': false,
                    'global': false,
                    'url': 'assets/Levels/L1.json',
                    'dataType': "json",
                    'success': function (data) {
                        json = data;
                    }
                });
                return json;
            })();
            room = "5-5";
            fade = 2;

            function canGo(room) {
                if (rooms[room]['paths'].includes('up')) {
                    $('#button-up').prop('disabled', false);
                    $('.up').addClass('active');
                } else {
                    $('#button-up').prop('disabled', true);
                    $('.up').removeClass('active');
                };
                if (rooms[room]['paths'].includes('down')) {
                    $('#button-down').prop('disabled', false);
                    $('.down').addClass('active');
                } else {
                    $('#button-down').prop('disabled', true);
                    $('.down').removeClass('active');
                };
                if (rooms[room]['paths'].includes('left')) {
                    $('#button-left').prop('disabled', false);
                    $('.left').addClass('active');
                } else {
                    $('#button-left').prop('disabled', true);
                    $('.left').removeClass('active');
                };
                if (rooms[room]['paths'].includes('right')) {
                    $('#button-right').prop('disabled', false);
                    $('.right').addClass('active');
                } else {
                    $('#button-right').prop('disabled', true);
                    $('.right').removeClass('active');
                };
            };

            function blink() {
                switch (window.fade) {
                    case 1:
                        $('body').addClass('black');
                        setTimeout(() => {
                            $('body').removeClass('black');
                        }, 250);
                        break;
                    case 2:
                        $('body').addClass('black');
                        setTimeout(() => {
                            $('body').removeClass('black');
                        }, 500);
                        break;
                };
            };

            function checkRoom(room) {
                // Shops
                if (rooms[room]['shop'].length != 0) {
                    $('#shop').prop('disabled', false);
                    $('#shop-item').html(rooms[room]['shop'].join(''));
                    $('#shop-price').html(rooms[room]['shop price'].join('') + 'g');
                } else {
                    $('#shop').prop('disabled', true);
                    $('#shop-item').html('');
                    $('#shop-price').html('');
                };
                // Items
                if (rooms[room]['item'].length != 0) {
                    $('#item').prop('disabled', false);
                    $('#item').html(rooms[room]['item'].join(''));
                } else {
                    $('#item').prop('disabled', true);
                    $('#item').html('');
                };
                // Enemies
                if (rooms[room]['enemy'].length != 0) {
                    $('#enemy').prop('disabled', false).html(rooms[room]['enemy'].join(''));
                    $('#attack-l').prop('disabled', false).html('Light Attack');
                    $('#attack-m').prop('disabled', false).html('Medium Attack');
                    $('#attack-h').prop('disabled', false).html('Heavy Attack');
                } else {
                    $('#enemy').prop('disabled', true).html('');
                    $('#attack-l').prop('disabled', true).html('');
                    $('#attack-m').prop('disabled', true).html('');
                    $('#attack-h').prop('disabled', true).html('');
                };
            };

            function go(room, direction) {
                if (rooms[room]['paths'].includes(direction)) {
                    const splitroom = room.split("");
                    switch (direction) {
                        case "up":
                            window.room = (parseInt(splitroom[0])+0)+"-"+(parseInt(splitroom[2])-1);
                            break;
                        case "down":
                            window.room = (parseInt(splitroom[0])+0)+"-"+(parseInt(splitroom[2])+1);
                            break;
                        case "left":
                            window.room = (parseInt(splitroom[0])-1)+"-"+(parseInt(splitroom[2])+0);
                            break;
                        case "right":
                            window.room = (parseInt(splitroom[0])+1)+"-"+(parseInt(splitroom[2])+0);
                            break;
                    };
                };
                console.log(fade)
                switch (window.fade) {
                    case 0:
                        $('.title').html(window.room);
                        canGo(window.room);
                        checkRoom(window.room);
                        break;
                    case 1:
                        blink();
                        setTimeout(() => {
                            $('.title').html(window.room);
                            canGo(window.room);
                            checkRoom(window.room);
                        }, 250);
                        break;
                    case 2:
                        blink();
                        setTimeout(() => {
                            $('.title').html(window.room);
                            canGo(window.room);
                            checkRoom(window.room);
                        }, 500);
                        break;
                };
            };

            // x = 0
            // while (x != 4) {
            //     selector = Math.floor(Math.random() * (Object.keys(rooms).length - 1));
                
            //     if (rooms[Object.keys(rooms)[selector]]['enemy'].length == 0 && Object.keys(rooms)[selector] != '5-5') {
            //         x += 1;
            //         rooms[Object.keys(rooms)[selector]]['enemy'].push(names[Math.floor(Math.random() * 9)]);
            //     };
            // };

            var Attack_Bonus = 0;
            var Attack_Modifier = 1;
            var Dodge_Bonus = 0;
            var Dodge_Modifier = 1;

            function Attack(Attack_Bonus, Attack_Modifier, Dodge_Bonus, Dodge_Modifier) {
                Attack_roll = Math.floor( (Math.floor( Math.random() * 20 + 1 ) + Attack_Bonus) * Attack_Modifier );
                Dodge_roll = Math.floor( (Math.floor( Math.random( ) * 20 + 1 ) + Dodge_Bonus) * Dodge_Modifier );

                console.log('Attack : ' + Attack_roll);
                console.log('Dodge : ' + Dodge_roll);
            };
        </script>

        <script>
            
        </script>
    </body>
</html>