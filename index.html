<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="https://narikraus.github.io/Rogue-like-RPG/" target="_blank">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
        
        <link href="assets/css/style.css" rel="stylesheet">
        <link href="assets/css/pixel-image.css" rel="stylesheet">

        <title>Rogue-Like RPG</title>
        <link rel="shortcut icon" href="assets/ico/Ico.ico">
    </head>
    <body>
        <main>
            <div class="row">
                <div class="col">
                    <div class="container">
                        <div class="item-modal border-shadow align-content-center justify-content-center row">
                                
                            <div class="pixel North-West"></div>
                            <div class="pixel North Up-West"></div>
                            <button disabled id="button-up" class="pixel North up h4" onclick="go(room, 'up')">up</button>
                            <div class="pixel North Up-East"></div>
                            <div class="pixel North-East"></div>
                            
                            <div class="w-100"></div>
            
                            <div class="pixel West Left-North"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel middle h4" id="title"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel East Right-North"></div>
                            
                            <div class="w-100"></div>
            
                            <button disabled id="button-left" class="pixel West left h4" onclick="go(room, 'left')">left</button>
                            <div class="pixel middle"></div>
                            <button class="pixel middle" onclick="
                                canGo(room);
                                checkRoom(room);
                                $('#title').html(window.room);
                                $(this).replaceWith(`<div class='pixel middle' id='enemy'></div>`);
                            " id="start">
                                <div class="h4">Start</div>
                                <div class="h4">Game</div>
                            </button>
                            <div class="pixel middle"></div>
                            <button disabled id="button-right" class="pixel East right h4" onclick="go(room, 'right')">right</button>
                            
                            <div class="w-100"></div>
            
                            <div class="pixel West Left-South"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel middle"></div>
                            <div class="pixel East Right-South"></div>
                            
                            <div class="w-100"></div>
            
                            <div class="pixel South-West"></div>
                            <div class="pixel South Down-West"></div>
                            <button disabled id="button-down" class="pixel South down h4" onclick="go(room, 'down')">down</button>
                            <div class="pixel South Down-East"></div>
                            <div class="pixel South-East"></div>
    
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="container">
    
                        <div class="item-modal border-shadow">
                            <div class="item-wrapper">
                                <div class="info-box border-shadow">
                                    <span class="info-title">Health</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerHealth">20</span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Weapon</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerWeapon">
                                            <button class="equipped-item tip" itemcatagory="Weapon" itemtype="Unarmed" extraTraits='[]'>Unarmed</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Armour</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerArmour">
                                            <button class="equipped-item tip" itemcatagory="Armour" itemtype="Unarmoured" extraTraits='[]'>Unarmoured</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Status</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerStatus"></span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow">
                                    <span class="info-title">Inventory</span>
                                    <div class="info-content">
                                        <span class="info-value" id="playerInventory">
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Leather" extraTraits='[]'>Leather</button>
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Plate" extraTraits='[]'>Plate</button>
                                            <button class="inventory-item tip" itemcatagory="Armour" itemtype="Spiked" extraTraits='[]'>Spiked</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Club" extraTraits='[]'>Club</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Dagger" extraTraits='[]'>Dagger</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Greatsword" extraTraits='[]'>Greatsword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Spear" extraTraits='[]'>Spear</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Longsword" extraTraits='[]'>Longsword</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Mace" extraTraits='[]'>Mace</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Short Spear" extraTraits='[]'>Short Spear</button>
                                            <button class="inventory-item tip" itemcatagory="Weapon" itemtype="Short Sword" extraTraits='[]'>Short Sword</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Lesser Healing" extraTraits='[]'>Potion of Lesser Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Healing" extraTraits='[]'>Potion of Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Greater Healing" extraTraits='[]'>Potion of Greater Healing</button>
                                            <button class="inventory-item tip" itemcatagory="Potion" itemtype="Potion of Power" extraTraits='[]'>Potion of Power</button>
                                            <button class="inventory-item tip" itemcatagory="Poison" itemtype="Poison" extraTraits='[]'>Poison</button>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow" style="overflow: auto;">
                                    <button class="info-title" onclick="$('.adventure-container').show()">Log</button>
                                    <div class="info-content" style="max-height: 300px;">
                                        <span class="info-value" id="infoLog">
                                            <span>The player begins their adventure.</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-box border-shadow row justify-content-center" style="margin-top: auto;">
                                    <div class="info-content">
                                        <button class="attack-button">Attack</button>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                    </div>
                </div>
            </div>
        </main>

        <div class="update-container">
            <div class="update-log">
                <button class="close-log-button" onclick="$('.update-container').remove();">Close</button>
                <pre>
<code>
<span class="markdown-green">23/06/2022</span>

<span class="markdown-blue"># Update Log</span>
<span class="markdown-red">-</span> The page now has an actual favicon and title.
<span class="markdown-red">-</span> Customised scroll bar for elements such as the inventory.

<span class="markdown-blue"># Bug Fixes</span>
<span class="markdown-red">-</span> Doffing a weapon or armour will no longer cause the stats panel to be duplicated for said elements.
<span class="markdown-red">-</span> Enemy spawning has been fixed to now spawn randomly around the map. (There is still always a Kobold in room 5-4)
<span class="markdown-red">-</span> Enemies will no longer generate with just the first 2 letters of their name.

<span class="markdown-blue"># Next Tasks</span>
<span class="markdown-red">-</span> Making the log system show the most recent input, with an option to view all previous log inputs.
<span class="markdown-red">-</span> Allowing the player to get to the 2nd and 3rd levels.
<span class="markdown-red">-</span> Making more gear and enemy traits, as well as applying them better in combat.
<span class="markdown-red">-</span> Creating status effects such as Poisoned, Enraged and Undead.
<span class="markdown-red">-</span> Creating usable single-use potions and poisons.
<span class="markdown-red">-</span> Capping the inventory to a maximum capacity yet to be decided.
<span class="markdown-red">-</span> Prevent running from monsters.
<span class="markdown-red">-</span> Create an Enchantment system.

<span class="markdown-blue"># Bugs</span>
<span class="markdown-red">-</span> Player death is not permanent.
<span class="markdown-red">-</span> The vampiric trait heals for floating point numbers.

<span class="markdown-italics">Please note that visuals do not work properly on mobile devices.</span>
</code>
                </pre>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="assets/js/main.js"></script>
        <script src="assets/js/traits.js"></script>

        <script>
            var player = null;
            var foes = null;
            var armour = null;
            var potions = null;
            var weapons = null;
            var rooms = null;

            function getData(url, cb, spawn) {
                fetch(url)
                .then(response => response.json())
                .then(result => cb(result));
            }

            

            // getData(url, (data) => console.log({ data }));

            getData("json/player.json", (data) => player = data );
            getData("json/foes.json", (data) => foes = data );
            getData("json/armour.json", (data) => armour = data );
            getData("json/poisons.json", (data) => poisons = data );
            getData("json/potions.json", (data) => potions = data );
            getData("json/weapons.json", (data) => weapons = data );
            getData("assets/Levels/L1.json", (data) => rooms = data );

            var fade = 2;
            var room = "5-5";

            function loadmap(level) {
                getData("assets/Levels/" + level + ".json", (data) => window.rooms = data )

                room = "5-5";
                $('.title').html(window.room);
                canGo(window.room);
                checkRoom(window.room);
            };

            function spawnMonsters(){
                if (rooms != null) {
                    x = 0;
                    while (x != 4) {
                        selector = Math.floor(Math.random() * (Object.keys(window.rooms).length - 1));
                        
                        if (window.rooms[Object.keys(window.rooms)[selector]]['enemy'].length == 0 && Object.keys(window.rooms)[selector] != '5-5' && Object.keys(window.rooms)[selector] != '5-4') {
                            x += 1;
                            window.rooms[Object.keys(window.rooms)[selector]]['enemy'].push(Object.keys(foes)[Math.floor(Math.random() * 9)]);
                        };
                    };
                } else {
                    setTimeout(spawnMonsters, 250);
                };
            };

            spawnMonsters();

            var bypassCheck = document.location.search;

            if (bypassCheck.includes('NoUpdateLog')) {
                $('.update-container').remove();
            };

        </script>
        <div class="adventure-container" style="display: none;">
            <div class="adventure-log" id="log-store" style="flex-direction: column;">
                <button class="close-log-button" onclick="$('.adventure-container').hide();">Close</button>
            </div>
        </div>
    </body>
</html>